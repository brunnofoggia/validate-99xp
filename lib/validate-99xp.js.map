{"version":3,"file":"validate-99xp.js","sources":["../src/validate-99xp.js"],"sourcesContent":["// [validate-99xp](https://github.com/brunnofoggia/validate-99xp) is the automated way\n// to keep your json or model attributes valid. See [v8n-99xp](https://github.com/brunnofoggia/v8n-99xp)\n// and [v8n](https://imbrn.github.io/v8n/) to know more about validators available.\n\n\n// Instructions\n// --------------\n\n// To make a field mandatory set it equal to [] or set your rules instead\n\n//     var validations = { name: [] }\n\n//     var validations = { name: [ [v8n().fullname(), 'Enter your fullname'] ] }\n\n// To make a field not mandatory you can either no list it in your stack of field validations of set it to false\n\n//     var validations = { name: false }\n\n// Advanced topics: \n\n// 1. You can also send a function for validations so you can define your rules according to values received\n\n// 2. On rule array you can send a third value that is called \"getValue\".\n// That will be a function responsible for return a value to be validated for that field \n\n//     var validations = { name: [ [v8n().fullname(), 'Enter your fullname', ()=>{ return 'any other variable'; }] ] }\n\n// 3. If you want to test a value received in realtime from user input set validateAll to false\n\n//     vl.validate({ name: '99xp' }, {validateAll: false})\n\n// 4. Complex objects works well too.\n\n//     var json = {name: '99xp', contacts: [ {email: 'team@99xp.org'} , {email: 'admin@99xp.org'} ]};\n//     var validations = {name: [], 'contacts[][email]': []};\n//     vl.validate(json, {validations})\n\n// Examples\n// --------------\n\n//     - simple validation\n//     var validations = { name: [ [v8n().fullname(), 'Enter your fullname'] ] }\n//     var json = { name: 'bruno' }\n//     var r;\n//     if((r = vl.validate(json, {validations}))!==null) {\n//          console.log(r);\n//     }\n\n//     - making a field just mandatory\n//     var validations = { name: [] }\n//     var json = { name: 'bruno' }\n//     var r;\n//     if((r = vl.validate(json, {validations}))!==null) {\n//          console.log(r);\n//     }\n\n\n// CODE DOCUMENTED BELOW\n// --------------\n\n// --------------\n\n// Baseline setup\n// --------------\nimport v8n from 'v8n-99xp';\nimport _ from 'underscore-99xp';\n\nvar vl = {\n    validator: v8n,\n    deepValueSearch: _.deepValueSearch,\n    validateAll: true,\n    // Core method the walk through fields and their set of rules applying each one of them\n    validate(attrs, options = {}) {\n        options = _.defaults(options, {\n            validateAll: this.validateAll\n        });\n\n        var error = [],\n            validations = this.getValidations(attrs, options),\n            notEmptyValidation = this.validator().passesAnyOf(this.validator().minLength(1), this.validator().not.undefined().not.null().pattern(/.+/)),\n            isRequired = {}; \n\n        // walk through fields listed as required\n        for (let field in validations) {\n            isRequired[field] = true;\n            var value = this.deepValueSearch(field, attrs, true);\n\n            // working with array so we can validate lists like \"contacts[][email]\"\n            (\n                (!_.isArray(value) && !_.isJSON(value)) ||\n                (!/\\[\\]\\[\\w+\\]/.test(field) && _.isArray(value)) // ensure to pass the correct value to test length of lists\n            ) && (value = [value]);\n            !_.isArray(validations[field]) && (validations[field] = [validations[field]]);\n\n            // walk through field rule specifications\n            for (let x in validations[field]) {\n                let validation = validations[field][x];\n\n                if (typeof validation[0] === 'boolean' || typeof validation[0] === 'undefined') {\n                    isRequired[field] = !(validation === false);\n                    if (!isRequired[field]) { continue; }\n                    // if is required, set default validation and error message for it\n                    validation = [notEmptyValidation, validation[1] || this.getRequiredErrorMessage(field), validation[2] || null];\n                }\n\n                error = error.concat(this.validateValues(value, isRequired[field], options.validateAll, field, attrs, validation));\n            }\n        }\n\n        return error.length > 0 ? error : null;\n    },\n    validateValues(value, isRequired, validateAll, field, attrs, validation) {\n        var error = [];\n        for (var x in value) {\n            error = error.concat(this.validateValue(x, value[x], isRequired, validateAll, field, attrs, validation));\n        }\n\n        return error;\n    },\n    validateValue(x, value, isRequired, validateAll, field, attrs, validation) {\n        var error = [];\n        let validationValue = this.getValidationValue(validation, value, attrs, field);\n        if (this.isRequiredNow(validationValue, isRequired, validateAll) &&\n            !this.isValid(field, attrs, validation[0], validationValue)) {\n            error.push([field, validation[1], x]);\n        }\n\n        return error;\n    },\n    getValidationValue(validation, value, attrs, field) {\n        if (!validation[2] || typeof validation[2] !== 'function') {\n            return value;\n        }\n        return validation[2](value, attrs, field);\n    },\n    getValidations(attrs, options = {}) {\n        var definedValidations = _.result2(this, 'validations', {}, [attrs, options], this),\n            validations = _.result2(options, 'validations', definedValidations, [attrs, options], this);\n\n        return validations;\n    },\n    // Run through all validations to collect mandatory fields and validations\n    getMandatoryValidations(attrs, options = {}) {\n        var validations = this.getValidations(attrs, options), mandatory = {};\n\n        // walk through fields listed as required\n        for (let field in validations) {\n            !_.isArray(validations[field]) && (validations[field] = [validations[field]]);\n            // walk through field rule specifications\n            for (let x in validations[field]) {\n                let validation = validations[field][x];\n                if (typeof validation[0] === 'undefined' || \n                    (typeof validation[0] === 'boolean' && validation[0] !== false) || \n                    (typeof validation[0] === 'object' && !validation[0].test(''))) {\n                    !(field in mandatory) && (mandatory[field] = []);\n                    mandatory[field].push(validation);\n                }\n            }\n        }\n\n        return mandatory;\n    },\n    // A field will be required when its present in the set of rules - even if its value is an empty [] - \n    // AND (its present in the values received OR (its set as required and validate all was set true)) . \n    // A bit confusing I know. But this will allow you to run validate in your form everytime a field is changed avoiding\n    // to alert of invalid fields that yet weren't filled by the guest\n    isRequiredNow(input, fieldRequired = false, validateAll) {\n        // the field will be required only if its value was sent or if its set as required (even without a specific rule)\n        return (typeof input !== 'undefined') || (!!fieldRequired && !!validateAll);\n    },\n    // Apply the rule test to value received. value, attrs inputted and field name are sent to validation method - it can be handy.\n    isValid(field, attrs, validation, value) {\n        if (!validation.test(value)) {\n            return false;\n        }\n        return true;\n    },\n    requiredErrorMessage: 'Field *{{field}}* cannot be empty',\n    getRequiredErrorMessage(field) {\n      return _.template(this.requiredErrorMessage)({\n          field\n        });\n    },\n};\n\nexport default vl;\n"],"names":["vl","validator","v8n","deepValueSearch","_","validateAll","validate","attrs","options","defaults","error","validations","getValidations","notEmptyValidation","passesAnyOf","minLength","not","undefined","null","pattern","isRequired","field","value","isArray","isJSON","test","x","validation","getRequiredErrorMessage","concat","validateValues","length","validateValue","validationValue","getValidationValue","isRequiredNow","isValid","push","definedValidations","result2","getMandatoryValidations","mandatory","input","fieldRequired","requiredErrorMessage","template"],"mappings":"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"}